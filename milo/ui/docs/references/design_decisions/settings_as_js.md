# Serve UI_VERSION and SETTINGS as JavaScript files

LUCI UI's UI_VERSION and SETTINGS are served as JS files generated by the server
(GET /settings.js, /ui_version.js).

## Rationale

* They cannot be static assets because the version info and settings are not
  available at compile time.
* It's not enough to return them from REST endpoints because:
  * We want to load them synchronously so they can be used by other JS modules.
  * We want to load them in service workers. Updating settings/version should
    trigger service worker updates.
* While it's possible to keep them in index.html, doing so can lead to several
  challenges:
  * The UI service needs to populate index.html with version info and settings.
    But we want to keep the UI service as simple as possible so can we roll it
    with less caution.
  * Updating version info and/or settings should trigger service worker
    updates, which means the UI service needs to dynamically render the UI
    service worker script as well to populate the revision info for index.html.
  * Any solution to inject version info and/or settings should also work with
    local development/testing/preview.

## Why UI_VERSION but no SERVER_VERSION?

We need UI_VERSION because without it, it's difficult to tell which version of
the UI an user is on due to caching (e.g. when investigating a bug report).

We do not want to report the version of the default service to the browser
because:

* The default service does not host any meaningful static assets (other
  than the ones for the go-template based legacy pages) that will be cached on
  the browser side. We can tell which version user is on by inspecting server
  logs and comparing the deployment history and user bug report time.
* We do not want a new default service release to trigger a service worker
  update on the browser side. There's no meaningful change to the browser side
  code.
* The server version given to the client UI via a config could be misleading
  because the browser will always call the current active version of the
  default service regardless which server version was active when the service
  worker was installed.
